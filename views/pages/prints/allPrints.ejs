<!DOCTYPE html>
<html>
    <head>
        <%- include ("../../partials/head") %>
        <link type="text/css" rel="stylesheet" href="../../public/css/prints.css" />
        <script src="../public/js/prints.js"></script>
    </head>

    <body>
        <%- include ("../../partials/header") %> <% if (printPage == 'all') {var isall = true} else {var isall =
        false}%> <%var i = 0%>
        <div class="container" style="margin-bottom: 100px">
            <div class="shadow card">
                <div class="card-header"><%- include ("../../partials/PrintDetails/printNav") %></div>
                <ol class="list-group list-group-flush border-top-0">
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-2"><strong>Name</strong></div>
                            <div class="col-2"><strong>Submitted</strong></div>

                            <%if (printPage == 'newSub') { %>
                            <div class="col-2"><strong>Send</strong></div>
                            <%}%> <%if (printPage == 'pendpay') { %>
                            <div class="col-2"><strong>Reviewed</strong></div>
                            <%}%> <%if (printPage == 'ready') { %>
                            <div class="col-2"><strong>Paid</strong></div>
                            <%}%> <% if (printPage == 'rejected') {%>
                            <div class="col-2"><strong>Reviewed</strong></div>
                            <%}%>

                            <div class="col">
                                <div class="row">
                                    <%if (printPage == 'pickup') {%>
                                    <div class="col-3">
                                        <strong>Printed</strong>
                                    </div>
                                    <%}%> <%if (printPage == 'completed') {%>
                                    <div class="col-3">
                                        <strong>Picked Up</strong>
                                    </div>
                                    <%}%> <% if (printPage == 'all') {%>
                                    <div class="col-3">
                                        <strong>Status</strong>
                                    </div>
                                    <%}%>

                                    <div class="col"><strong>File</strong></div>

                                    <%if (printPage == 'completed') {%>
                                    <div class="col text-right">
                                        <a class="clear-btn" href=""> Clear All </a>
                                    </div>
                                    <%}%> <%if (printPage == 'rejected') {%>
                                    <div class="col text-right">
                                        <a class="clear-rejected-btn" href=""> Clear All </a>
                                    </div>
                                    <%}%>
                                </div>
                            </div>
                        </div>
                    </li>
                    <%dbdata.forEach(function (item) {%>
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-2"><%= item.patron.fname %> <%= item.patron.lname %></div>
                            <div class="col-2"><%=item.dateSubmitted%></div>

                            <% if (printPage == 'newSub') {%>
                            <div class="col-2">
                                <%if(!item.allFilesReviewed){%>
                                <span
                                    class="d-inline-block"
                                    tabindex="0"
                                    data-toggle="tooltip"
                                    data-placement="top"
                                    title="<% if (!item.allFilesReviewed) { %> Please review all files first! <%} else {%>Send to Patron<% } %>"
                                >
                                    <svg
                                        class="bi bi-person-check"
                                        width="25px"
                                        height="25px"
                                        viewBox="0 0 16 16"
                                        fill="#aaa"
                                        xmlns="http://www.w3.org/2000/svg"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M14 3H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2z"
                                        />
                                        <rect width="3" height="3" x="2" y="9" rx="1" />
                                        <path d="M1 5h14v2H1z" />
                                    </svg>
                                    <%} else {%>
                                    <button
                                        type="button"
                                        style="border: none; background: transparent"
                                        class="submit-btn p-0"
                                        id="<%= item._id%>"
                                    >
                                        <svg
                                            class="bi bi-person-check"
                                            width="25px"
                                            height="25px"
                                            viewBox="0 0 16 16"
                                            fill="#000"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M14 3H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2z"
                                            />
                                            <rect width="3" height="3" x="2" y="9" rx="1" />
                                            <path d="M1 5h14v2H1z" />
                                        </svg>
                                    </button>
                                </span>
                                <%}%>
                            </div>
                            <%}%> <%if (printPage == 'pendpay' || printPage == 'rejected') {%>
                            <div class="col-2"><%=item.datePaymentRequested%></div>
                            <%}%> <% if (printPage == 'ready') {%>
                            <div class="col-2"><%=item.datePaid%></div>
                            <%}%>

                            <div class="col">
                                <%i = 0%> <% item.files.forEach(function (file) {%> <%if ( (printPage == 'newSub' ||
                                (printPage == 'pendpay' && file.isRejected == false) || printPage == 'all') || (
                                (printPage == 'ready' && file.isRejected == false && file.isPrinted == false) && (
                                (location != "all" && file.printLocation == location) || (location == 'all') ) ) || (
                                (printPage == 'pickup' && file.isRejected == false && file.isPrinted == true &&
                                file.isPickedUp == false) && ( (location != "all" && file.pickupLocation == location) ||
                                (location == 'all') ) ) || (printPage == 'completed' && file.isPickedUp) || (printPage
                                == 'rejected' && file.isRejected) ) { %> <%i++%>
                                <div class="row <%if (i > 1) {%> mt-3 <%}%>">
                                    <%if (printPage == 'pickup') {%>
                                    <div class="col-3">
                                        <%if (file.datePrinted != "Never") {%> <%=file.datePrinted%> <%}%>
                                    </div>

                                    <%}%> <% if (printPage == 'completed') {%>
                                    <div class="col-3">
                                        <%if (file.datePickedUp != "Never") {%> <%=file.datePickedUp%> <%}%>
                                    </div>
                                    <%}%> <% if (printPage == 'all') {%>
                                    <div class="col-3">
                                        <% if (file.isRejected) { %> Rejected <% } else if (file.isNewSubmission) { %>
                                        New <% } else if (file.isPendingPayment) { %> Pending payment <% } else if
                                        (file.isReadyToPrint) { %> In Queue <% } else if (file.isPrinted &&
                                        !file.isPickedUp) { %> Waiting for pickup <% } else { %> Complete <% } %>
                                    </div>
                                    <%}%>

                                    <div class="col">
                                        <a class="no" href='<%= "/prints/preview?fileID=" + file._id%>'>
                                            <%=file.realFileName%>
                                        </a>
                                        &nbsp; <%- include ("../../partials/PrintDetails/flags", {file:file, isAll:
                                        isall}) %>
                                    </div>
                                    <div class="col-1 text-right">
                                        <%- include ("../../partials/PrintDetails/fileBurger", {file:file, item:item})
                                        %>
                                    </div>
                                </div>
                                <%}%> <%})%>
                            </div>
                            <div class="col-auto">
                                <button
                                    type="button"
                                    style="border: none; background: transparent"
                                    data-toggle="tooltip"
                                    data-placement="left"
                                    title="Download all files in this submission"
                                    class="zip-btn p-0"
                                    id="<%= item._id%>"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="16"
                                        height="16"
                                        fill="currentColor"
                                        class="bi bi-save"
                                        viewBox="0 0 16 16"
                                    >
                                        <path
                                            d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"
                                        />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </li>
                    <%})%>
                </ol>
            </div>
        </div>
        <%- include ("../../partials/footer") %>
    </body>
</html>
