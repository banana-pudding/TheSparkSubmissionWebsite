<!doctype html>
<html>

<head>
    <%- include ("../partials/head") %>
    <script src="/public/js/details.js"></script>
    <script type="module" src='/public/js/stldisplay.js'></script>
    <link type="text/css" rel="stylesheet" href="/public/css/details.css">
</head>

<body>
    <%- include ("../partials/header") %>
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-img-top">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0"
                                aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div id="model-container">
                            <div id="loading-image"></div>
                            <div id="gui-container"></div>
                            <div id="model" filename='<%=print.fileName%>' style="width: 100%; height: 500px"></div>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered table-sm">
                            <thead>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>File name</td>
                                    <td>
                                        <%- include ("../partials/downloadbutton", {file:print}) %>
                                        &nbsp;
                                        <%=print.fileName.substring(print.fileName.lastIndexOf("sparkdelim") + 10)%>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Submitted on</td>
                                    <td><%=print.dateSubmitted%></td>
                                </tr>
                                <tr>
                                    <td>Material</td>
                                    <td><%=print.material%></td>
                                </tr>
                                <tr>
                                    <td>Infill</td>
                                    <td><%=print.infill%></td>
                                </tr>
                                <tr>
                                    <td>Color</td>
                                    <td><%=print.color%></td>
                                </tr>
                                <tr>
                                    <td>Copies</td>
                                    <td><%=print.copies%></td>
                                </tr>
                                <tr>
                                    <td>Notes</td>
                                    <td><%=print.notes%></td>
                                </tr>
                                <tr>
                                    <td>Print location</td>
                                    <td>
                                        <%=print.printLocation%>
                                        &nbsp;
                                        <div class="icon-btn" data-toggle="tooltip" data-placement="top"
                                            title="Change Location">
                                            <svg class="bi bi-arrow-left-right change-btn" fileID='<%=print._id%>'
                                                width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                    d="M10.146 7.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L12.793 11l-2.647-2.646a.5.5 0 0 1 0-.708z" />
                                                <path fill-rule="evenodd"
                                                    d="M2 11a.5.5 0 0 1 .5-.5H13a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 11zm3.854-9.354a.5.5 0 0 1 0 .708L3.207 5l2.647 2.646a.5.5 0 1 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 0 1 .708 0z" />
                                                <path fill-rule="evenodd"
                                                    d="M2.5 5a.5.5 0 0 1 .5-.5h10.5a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                                            </svg>
                                        </div>

                                    </td>
                                </tr>
                                <tr>
                                    <td>Pickup location</td>
                                    <td><%=print.pickupLocation%></td>
                                </tr>
                                <tr>
                                    <td>Reviewed on</td>
                                    <td>
                                        <%if (print.isReviewed) {%>
                                        <%=print.dateReviewed%>
                                        <%} else {%>
                                        Not reviewed
                                        <%}%>
                                        </td>
                                    </tr>
                
                
                                    <% if(print.isReviewed) {%>
                                <tr>
                                    <td>Status</td>
                                    <td>
                                        <%if (print.isReviewed) {%>
                                        <% if (print.isRejected) {%>
                                        Rejected
                                        <%} else { %>
                                        Accepted
                                        <%}%>
                                            <%} else {%>
                                        Not reviewed
                                        <%}%>
                                        </td>
                                    </tr>
                                    <%}%>
                                        <% if (print.isReviewed && !print.isRejected) {%>
                                <tr>
                                    <td>Print time estimate</td>
                                    <td>
                                        <%if (print.isReviewed) {%>
                                        <%= print.timeHours%> hours, <%= print.timeMinutes%> minutes
                                        <%} else {%>
                                        Not reviewed
                                        <%}%>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Print weight estimate</td>
                                        <td>
                                            <%if (print.isReviewed) {%>
                                        <%= print.grams%> grams
                                        <%} else {%>
                                        Not reviewed
                                        <%}%>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>GCODE file</td>
                                        <td>
                                            
                                            <%if (print.isReviewed) {%>
                                        <%- include ("../partials/downloadbutton", {file:print}) %>
                                        &nbsp;
                                        <%=print.gcodeName.substring(print.gcodeName.lastIndexOf("sparkdelim") + 10)%>

                                        <%} else {%>
                                        Not reviewed
                                        <%}%>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Sliced for printer</td>
                                        <td><%=print.slicedPrinter%></td>
                                </tr>
                                <tr>
                                    <td>Sliced for material</td>
                                    <td><%=print.slicedMaterial%></td>
                                </tr>
                                <%}%>
                                    
                
                
                                    <tr>
                                        <td>Paid on</td>
                                        <td>
                                            <%if (print.isPaid) {%>
                                <%=print.datePaid%>
                                <%} else {%>
                                Not paid
                                <%}%>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Picked up on</td>
                                        <td>
                                            <%if (print.isPickedUp) {%>
                                <%=print.datePickedUp%>
                                <%} else {%>
                                Not picked up
                                <%}%>
                                        </td>
                                    </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
            </div>

            <div class="col">
                <% if (print.canBeReviewed) { %>
                <div class="card card-body">
                    <form action="/prints/singleReview" method="post" enctype="multipart/form-data">
                        <div class="hiddenExtras" style="display: none;">
                            <input type="text" name="fileID" value='<%= print._id%>'>
                        </div>

                        <div class="form-group">
                            <label>Decision</label>
                            <select class="form-control" id="decision" name="decision" required>
                                <option value="accepted">Accepted</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>

                        <div class="accepted-controls">
                            <div class="form-group">
                                <div class="form-row">
                                    <div class="col-3">
                                        <label class="col-form-label">Est. time</label>
                                    </div>
                                    <div class="col-9">
                                        <div class="form-row">
                                            <div class="col-4">
                                                <input type="number" class="form-control" name="hours" required>
                                            </div>
                                            <div class="col-2">
                                                <input type="text" readonly class="form-control-plaintext"
                                                    value="hrs">
                                            </div>
                                            <div class="col-4">
                                                <input type="number" class="form-control" name="minutes" required>
                                            </div>
                                            <div class="col-2">
                                                <input type="text" readonly class="form-control-plaintext"
                                                    value="mins">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-row">
                                    <div class="col-3">
                                        <label class="col-form-label">Est. material</label>
                                    </div>
                                    <div class="col-9">
                                        <div class="form-row">
                                            <div class="col-10">
                                                <input type="number" class="form-control" name="grams" required>
                                            </div>
                                            <div class="col-2">
                                                <div class="col">
                                                    <input type="text" readonly class="form-control-plaintext"
                                                        value="g">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="form-group">
                                <label>Print Location</label>
                                <select class="form-control" id="locationSelector" name="printLocation" required>
                                    <option value="Willis Library">Willis Library</option>
                                    <option value="Discovery Park">Discovery Park</option>
                                </select>
                            </div>

                            <div class="form-group no-bottom">
                                <label>GCODE Details</label>
                                <div class="custom-file" id="customFile" lang="es">
                                    <input name="uploadedFile" type="file" class="custom-file-input "
                                        id="exampleInputFile" aria-describedby="fileHelp" required>
                                    <label class="custom-file-label top-radius" for="exampleInputFile">
                                        Upload GCODE
                                    </label>
                                </div>
                            </div>

                            <div class="form-group no-bottom">
                                <input type="text" class="form-control middle-radius" name="printer"
                                    placeholder="Sliced for printer..." required>
                            </div>

                            <div class="form-group">
                                <input type="text" class="form-control bottom-radius" name="material"
                                    placeholder="Sliced for material..." required>
                            </div>

                            <div class="form-group">
                                <label for="technotes">Technician Notes</label>
                                <textarea name="technotes" class="form-control" rows="2"></textarea>
                            </div>

                        </div>

                        <div class="form-group">
                            <label for="patronNotes">Notes to Patron</label>
                            <textarea name="patronNotes" class="form-control" rows="2"></textarea>
                        </div>


                        <button type="submit" class="btn btn-success submit-btn">Submit</button>
                    </form>
                </div>
                <% } %>
            </div>
        </div>
    </div>
</body>

</html>